### Model without covariates: gamma prior for precision
We now assess whether an inverse gamma prior would be a better prior.

#### Pilot model

##### Creating model

We manually adapt the previous model to use an inverse gamma prior for the precision instead of a uniform prior ("JAGSmodel0_inversegamma.txt"). We apply this manual process, since `runjags` does not allow to directly specify an inverse gamma prior using `template.jags`.

We again use the `run.jags` function to run the model we just specified our syntax for. We choose a limited burn-in (4000) and sample (10000) to allow for an initial pilot run. 
<!--- Should method=rjags be  used in original model design (see documentation extend.jags - then no need to recompile model when extending) --->

(modify the source file if needed)
  
```{r cache=TRUE}
JAGS.mod_gamma <- run.jags(
  #Note: reading in modified source file
  "src/JAGSmodel0_inversegamma.txt", # specify the modified syntax file
  data = RN4CAST_complete, # specify the data source (only necessary when write.data = FALSE)
  monitor = c("intercept", "unit_precision", "hosp_precision", "full_effect", "deviance"),
  burnin = burn_in_iterations, # make informed decision later (choosing speed here)
  sample = sample_iterations, # make informed decision later (choosing speed here)
  method = "rjags",
  n.chains = 5
)
```

##### Visualization

Before assessing the model based through formal measures, we first do a visual inspection as we did for the previous model.
For example, here are the trace plots and autocorrelation plotss for the precision of the random intercept for unit (`unit_precision`) and for hospital (`hosp_precision`):
  
```{r, message=FALSE, out.width="50%", fig.align='center'}
plot(JAGS.mod_gamma, plot.type = "trace", vars = "unit_precision")
plot(JAGS.mod_gamma, plot.type = "autocorr", vars = "unit_precision")
plot(JAGS.mod_gamma, plot.type = "trace", vars = "hosp_precision")
plot(JAGS.mod_gamma, plot.type = "autocorr", vars = "hosp_precision")
# rmeanplot(JAGS.mod_uniform, parms = "unit_precision")
```
The autocorrelation plots show that the autocorrelation is limited (about 0 at lag5 for both `unit_precision` and `hosp_precision`). 
The trace plots for `unit_precision` and for `hosp_precision` look well. 

##### Assessment model

The model ran, and we can inspect its results.

```{r -3}
summary(JAGS.mod_gamma)
```

The Gelman-Rubin ANOVA diagnostic (i.e. estimated potential scale reduction factor - PSRF) is close to 1 for both `unit_precision` and
 `hosp_precision`, which is the aim. Also, the MCMC error is small in comparison with the SD (0.6% for both `unit_precision` and `hosp_precision`).

We subsequently obtain the DIC (Deviance Information Criterion) to assess the model performance.

```{r _gamma}
dic_gamma <- extract(JAGS.mod_gamma, what = "dic")
dic_gamma
```

The results are the following:
  
- Mean deviance:  8892 
- penalty 122.9 
- Penalized deviance: 9015 

These results are worse than those obtained under uniform priors for the precision, although this is mainly due to the higher penalty term (given that the IG prior is a more complex modelled prior than the uniform prior used earlier).

#### Further expand model
Extend model with additional samples (i.c. 30 000).

```{r}
JAGS.mod_gamma <- extend.jags(
  # model to extend
  JAGS.mod_gamma,
  # burnin = burn_in_iterations, # No need to include additional burnin now (default = 0) since we expand instead of rerun model??
  sample = more_sample_iterations, # make informed decision later (choosing speed here)
)
```

##### Visualization

Perform visual inspection of trace plots for `unit_precision` and `hosp_precision` for extended model.
<!--- using reference of previous code block ?? --->
```{r-extend, ref.label='traceplots'}
```

```{r, message=FALSE, out.width="50%", fig.align='center'}
plot(JAGS.mod_gamma, plot.type = "trace", vars = "unit_precision")
plot(JAGS.mod_gamma, plot.type = "autocorr", vars = "unit_precision")
plot(JAGS.mod_gamma, plot.type = "trace", vars = "hosp_precision")
plot(JAGS.mod_gamma, plot.type = "autocorr", vars = "hosp_precision")
```

The trace plots for `unit_precision` and `hosp_precision` did not change a lot.

##### Assessment model

Then we inspect the results again.
<!--- using reference of previous code block ?? --->
```{r-extend, ref.label='summary-mod'}
```

```{r}
summary(JAGS.mod_gamma)
```

The Gelman-Rubin ANOVA diagnostic (i.e. estimated potential scale reduction factor - PSRF) is still close to 1 for both `unit_precision` and `hosp_precision`, which is the aim. The MCMC error has also dropped substantially in comparison with the SD (0.5 for both `unit_precision` and for `hosp_precision`). 

We subsequently obtain the DIC (Deviance Information Criterion) to assess the model performance.

```{r_gamma}
dic_gamma <- extract(JAGS.mod_gamma, what = "dic")
dic_gamma
```

The results are the following:
-   Mean deviance:  8886 
-   penalty 124.4 
-   Penalized deviance: 9010 

These are very similar to the results obtained for the shorter chains with the gamma priors. 
